# Dead Letter Queue (DLQ) Example
# This pipeline demonstrates DLQ configuration for handling failures

input:
  aws_sqs:
    url: "http://localhost:4566/000000000000/input-queue"
    region: "us-east-1"
    endpoint: "http://localhost:4566"
    max_number_of_messages: 10
    wait_time_seconds: 20

processors:
  - metadata:
      correlation_id_field: "correlationId"

  - mapping:
      expression: |
        {
          "id": $message.id,
          "processedData": $uppercase(name),
          "timestamp": $message.timestamp
        }

output:
  redis_streams:
    url: "redis://localhost:6379"
    stream: "processed-messages"
    max_length: 1000

    # Retry configuration for output
    max_retries: 3                      # Retry up to 3 times before DLQ

# Dead Letter Queue for failed messages
dlq:
  aws_sqs:
    url: "http://localhost:4566/000000000000/dlq-queue"
    region: "us-east-1"
    endpoint: "http://localhost:4566"

# Failed messages in the DLQ will include:
# - dlq: true
# - dlqReason: "Error message"
# - dlqStack: "Stack trace"
# - dlqTimestamp: 1234567890
# - dlqAttempts: 4
# - originalMessageId: "original-msg-id"
