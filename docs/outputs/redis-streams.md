# Redis Streams Output

## Overview

Sends messages to Redis Streams with optional stream length management. Efficient for pub-sub patterns, event streaming, and message queuing between services.

## Configuration

### Required Fields

- `url`: Redis connection URL
- `stream`: Name of the Redis Stream to write to

### Optional Fields

- `max_length`: Maximum number of entries in the stream (optional, enables MAXLEN trimming)

## Examples

### Basic Example

```yaml
output:
  redis_streams:
    url: "redis://localhost:6379"
    stream: "processed-messages"
```

### With Stream Length Limit

```yaml
output:
  redis_streams:
    url: "redis://localhost:6379"
    stream: "processed-messages"
    max_length: 1000  # Keep only the most recent 1000 messages
```

### Authenticated Redis

```yaml
output:
  redis_streams:
    url: "redis://:secret@localhost:6379/0"  # With password and database
    stream: "secure-stream"
    max_length: 5000
```

### Production Configuration

```yaml
output:
  redis_streams:
    url: "redis://production-redis:6379"
    stream: "events"
    max_length: 10000

    # Connection configuration (inherited from parent config)
    max_retries: 3
```

## Features

- **Automatic Stream Creation**: Creates streams automatically if they don't exist
- **Stream Length Management**: Optional MAXLEN for automatic trimming
- **Message Metadata Preservation**: All metadata preserved as stream fields
- **Authentication Support**: Password-protected Redis instances
- **Database Selection**: Multiple Redis databases via URL
- **Atomic Writes**: Each message written atomically with XADD

## Use Cases

- Event streaming between microservices
- Real-time data pipelines
- Pub-sub messaging patterns
- Message queuing with consumer groups
- Event sourcing and audit logs
- IoT data collection
- Activity feeds and notifications

## Message Format

Messages are written to Redis Streams with the following structure:

```
Stream Entry ID: Auto-generated by Redis (e.g., "1642088445123-0")
Fields:
  - content: JSON-serialized message content
  - metadata: JSON-serialized metadata (correlationId, source, timestamps, etc.)
```

### Example Redis Stream Entry

```
127.0.0.1:6379> XREAD COUNT 1 STREAMS processed-messages 0
1) 1) "processed-messages"
   2) 1) 1) "1642088445123-0"
         2) 1) "content"
            2) "{\"orderId\":\"ORD-001\",\"amount\":100.00}"
            3) "metadata"
            4) "{\"correlationId\":\"550e8400-e29b-41d4-a716-446655440000\",\"source\":\"sqs\"}"
```

## Stream Length Management

The `max_length` parameter enables automatic trimming:

- **With `max_length`**: Stream keeps only the most recent N entries
- **Without `max_length`**: Stream grows indefinitely (manual cleanup required)
- **Trimming Strategy**: Uses MAXLEN with approximate trimming (~) for performance

### Choosing max_length

- **Small streams** (events): 1000-5000
- **Medium streams** (logs): 10000-50000
- **Large streams** (analytics): 100000+
- **Infinite retention**: Omit max_length (remember to monitor memory)

## Performance Considerations

- XADD is very fast (~100k writes/sec on modern hardware)
- Stream trimming has minimal overhead with approximate trimming
- Consider Redis persistence settings (AOF/RDB) based on durability needs
- For high throughput, consider Redis Cluster or multiple streams

## URL Format

```
redis://[password@]host:port[/db]
```

Examples:
- `redis://localhost:6379` - Basic connection
- `redis://:mypassword@localhost:6379` - With password
- `redis://localhost:6379/2` - Select database 2
- `redis://:secret@redis.example.com:6379/0` - Full format

## Troubleshooting

### Connection errors

- Verify Redis is running: `redis-cli ping`
- Check URL format and credentials
- Ensure network connectivity
- Verify database number exists (0-15 by default)

### Memory issues

- Set `max_length` to prevent unbounded growth
- Monitor Redis memory: `redis-cli INFO memory`
- Check Redis `maxmemory` setting
- Consider eviction policies for production

### Messages not appearing

- Verify stream name is correct
- Check with `redis-cli XLEN stream-name`
- Inspect entries with `redis-cli XREAD COUNT 10 STREAMS stream-name 0`
- Ensure output configuration is active in pipeline

### Performance issues

- Enable AOF/RDB persistence appropriately
- Use approximate trimming (automatic with max_length)
- Consider Redis Cluster for horizontal scaling
- Monitor Redis slow log: `redis-cli SLOWLOG GET 10`

## Redis Commands for Debugging

```bash
# Check stream length
redis-cli XLEN processed-messages

# Read first 10 messages
redis-cli XREAD COUNT 10 STREAMS processed-messages 0

# Read latest messages
redis-cli XREAD COUNT 10 STREAMS processed-messages $

# Stream info
redis-cli XINFO STREAM processed-messages

# Delete stream (careful!)
redis-cli DEL processed-messages
```

## See Also

- [Redis Streams Input](../inputs/redis-streams.md) - Read from Redis Streams
- [SQS Output](sqs.md) - Alternative output destination
- [Dead Letter Queue](../advanced/dlq.md) - Handle failed outputs
- [Backpressure Control](../advanced/backpressure.md) - Control output throughput
